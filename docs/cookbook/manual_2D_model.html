

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="python" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="python" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; triflow 0.5.0rc documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../doc.html" class="icon icon-home"> triflow
          

          
            
            <img src="../_static/logo_locie.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemes.html">Temporal schemes</a></li>
<li class="toctree-l1"><a class="reference internal" href="displays.html">Displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribution guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">triflow</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../doc.html">triflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../doc.html">Docs</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cookbook/manual_2D_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">triflow</span> <span class="kn">as</span> <span class="nn">trf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I stole this. It&#39;s pretty: shaded elevation plots. Nice.</span>
<span class="c1"># http://geoexamples.blogspot.fr/2014/03/shaded-relief-images-using-gdal-python.html</span>
<span class="c1"># I only use the hillshade, because lazy and stuff.</span>

<span class="k">def</span> <span class="nf">hillshade</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">angle_altitude</span><span class="p">):</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">azimuthrad</span> <span class="o">=</span> <span class="n">azimuth</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">altituderad</span> <span class="o">=</span> <span class="n">angle_altitude</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>


    <span class="n">shaded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
     <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuthrad</span> <span class="o">-</span> <span class="n">aspect</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">255</span><span class="o">*</span><span class="p">(</span><span class="n">shaded</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
<p>Triflow is not able to handle 2D simution by itself. We have to help and
provide our own routine. It will be slower than Triflow compiler, but
enough for our computation. We have to provide:</p>
<ul class="simple">
<li>The derivative F</li>
<li>A template for the fields (which describe their dimension and
coordinates)</li>
<li>The Jacobian for implicits schemes. Lazy me, we will drop the
jacobian for now.</li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NonConservative_ShallowWater</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
        <span class="n">Ffields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">delta_x</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">delta_y</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dxx</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">dyy</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">eta</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">H</span>
        <span class="n">visc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">var</span><span class="p">:</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dxx</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="n">dyy</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="n">dth</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">dx</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="n">dy</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">eta</span><span class="p">))</span>
        <span class="n">dtu</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dy</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">+</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span> <span class="o">-</span> <span class="mf">9.81</span> <span class="o">*</span> <span class="n">dx</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">visc</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">dtv</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">-</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span> <span class="o">-</span> <span class="mf">9.81</span> <span class="o">*</span> <span class="n">dy</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">visc</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">Ffields</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">dth</span>
        <span class="n">Ffields</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">dtu</span>
        <span class="n">Ffields</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">dtv</span>
        <span class="k">return</span> <span class="n">Ffields</span><span class="o">.</span><span class="n">uflat</span>
    <span class="n">_indep_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
    <span class="n">fields_template</span> <span class="o">=</span> <span class="n">trf</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">BaseFields</span><span class="o">.</span><span class="n">factory</span><span class="p">((</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span>
                                                         <span class="p">[(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)),</span>
                                                          <span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)),</span>
                                                          <span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))],</span>
                                                         <span class="p">[(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NonConservative_ShallowWater</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Ny</span> <span class="o">=</span> <span class="mi">350</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">Ny</span><span class="p">,</span> <span class="mi">5</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span>  <span class="c1"># It&#39;s like a drop. Or close enough</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">hillshade</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">H</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Wooow, a drop&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Wooow</span><span class="p">,</span> <span class="n">a</span> <span class="n">drop</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nicolas</span><span class="o">/.</span><span class="n">cache</span><span class="o">/</span><span class="n">pypoetry</span><span class="o">/</span><span class="n">virtualenvs</span><span class="o">/</span><span class="n">triflow</span><span class="o">-</span><span class="n">py3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">font_manager</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1328</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">findfont</span><span class="p">:</span> <span class="n">Font</span> <span class="n">family</span> <span class="p">[</span><span class="s1">&#39;serif&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="n">found</span><span class="o">.</span> <span class="n">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="n">DejaVu</span> <span class="n">Sans</span>
  <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">]))</span>
</pre></div>
</div>
<img alt="../_images/manual_2D_model_6_2.png" src="../_images/manual_2D_model_6_2.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_fields</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fields_template</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">pars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">1E-6</span><span class="p">}</span>  <span class="c1"># no coriolis effect, water viscosity</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I&#39;m a lazy shit, I don&#39;t want to provide the jacobian. Lucky me, scipy ode do not need it. (explicit schemes)</span>

<span class="n">simul</span> <span class="o">=</span> <span class="n">trf</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">init_fields</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">pars</span><span class="p">,</span> <span class="n">dt</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">scheme</span><span class="o">=</span><span class="n">trf</span><span class="o">.</span><span class="n">schemes</span><span class="o">.</span><span class="n">scipy_ode</span><span class="p">,</span> <span class="n">interpolator</span><span class="o">=</span><span class="s2">&quot;dopri5&quot;</span><span class="p">,</span>
                       <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;wave_animation&quot;</span><span class="p">)</span>
<span class="n">simul</span><span class="o">.</span><span class="n">attach_container</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c1"># some test, this directory will exist. force=True over-write.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">:</span>   <span class="kc">None</span>
<span class="kc">None</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">simul</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;t: {t:g}&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nicolas</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="mi">03</span><span class="o">-</span><span class="n">projets</span><span class="o">/</span><span class="mi">01</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="mi">01</span><span class="o">-</span><span class="n">repositories</span><span class="o">/</span><span class="n">triflow</span><span class="o">/</span><span class="n">triflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">schemes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">divide</span> <span class="n">by</span> <span class="n">zero</span> <span class="n">encountered</span> <span class="ow">in</span> <span class="n">double_scalars</span>
  <span class="n">dt_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tol</span> <span class="o">/</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">:</span> <span class="mf">0.4</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nicolas</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="mi">03</span><span class="o">-</span><span class="n">projets</span><span class="o">/</span><span class="mi">01</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="mi">01</span><span class="o">-</span><span class="n">repositories</span><span class="o">/</span><span class="n">triflow</span><span class="o">/</span><span class="n">triflow</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">container</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">130</span><span class="p">:</span> <span class="ne">FutureWarning</span><span class="p">:</span> <span class="n">casting</span> <span class="n">an</span> <span class="n">xarray</span><span class="o">.</span><span class="n">Dataset</span> <span class="n">to</span> <span class="n">a</span> <span class="n">boolean</span> <span class="n">will</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">xarray</span> <span class="n">v0</span><span class="o">.</span><span class="mi">11</span> <span class="n">to</span> <span class="n">only</span> <span class="n">include</span> <span class="n">data</span> <span class="n">variables</span><span class="p">,</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="o">.</span> <span class="n">Cast</span> <span class="n">the</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">variables</span> <span class="nb">property</span> <span class="n">instead</span> <span class="n">to</span> <span class="n">preserve</span> <span class="n">existing</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">forwards</span> <span class="n">compatible</span> <span class="n">manner</span><span class="o">.</span>
  <span class="k">if</span> <span class="n">concatenated_fields</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">container</span> <span class="o">=</span> <span class="n">simul</span><span class="o">.</span><span class="n">container</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">container</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">]</span>
<span class="n">norm_eta</span> <span class="o">=</span> <span class="p">((</span><span class="n">eta</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>  <span class="o">/</span> <span class="p">(</span><span class="n">eta</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>

<span class="n">interp_on_time</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span> <span class="n">norm_eta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hillshade</span><span class="p">(</span><span class="n">interp_on_time</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nicolas</span><span class="o">/.</span><span class="n">cache</span><span class="o">/</span><span class="n">pypoetry</span><span class="o">/</span><span class="n">virtualenvs</span><span class="o">/</span><span class="n">triflow</span><span class="o">-</span><span class="n">py3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">font_manager</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1328</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">findfont</span><span class="p">:</span> <span class="n">Font</span> <span class="n">family</span> <span class="p">[</span><span class="s1">&#39;serif&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="n">found</span><span class="o">.</span> <span class="n">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="n">DejaVu</span> <span class="n">Sans</span>
  <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">]))</span>
</pre></div>
</div>
<img alt="../_images/manual_2D_model_11_2.png" src="../_images/manual_2D_model_11_2.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">hillshade</span><span class="p">(</span><span class="n">interp_on_time</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nicolas</span><span class="o">/.</span><span class="n">cache</span><span class="o">/</span><span class="n">pypoetry</span><span class="o">/</span><span class="n">virtualenvs</span><span class="o">/</span><span class="n">triflow</span><span class="o">-</span><span class="n">py3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="n">font_manager</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1328</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">findfont</span><span class="p">:</span> <span class="n">Font</span> <span class="n">family</span> <span class="p">[</span><span class="s1">&#39;serif&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="n">found</span><span class="o">.</span> <span class="n">Falling</span> <span class="n">back</span> <span class="n">to</span> <span class="n">DejaVu</span> <span class="n">Sans</span>
  <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">]))</span>
</pre></div>
</div>
<img alt="../_images/manual_2D_model_12_1.png" src="../_images/manual_2D_model_12_1.png" />
<img alt="../_images/manual_2D_model_12_2.png" src="../_images/manual_2D_model_12_2.png" />
<img alt="../_images/manual_2D_model_12_3.png" src="../_images/manual_2D_model_12_3.png" />
<img alt="../_images/manual_2D_model_12_4.png" src="../_images/manual_2D_model_12_4.png" />
<img alt="../_images/manual_2D_model_12_5.png" src="../_images/manual_2D_model_12_5.png" />
<img alt="../_images/manual_2D_model_12_6.png" src="../_images/manual_2D_model_12_6.png" />
<img alt="../_images/manual_2D_model_12_7.png" src="../_images/manual_2D_model_12_7.png" />
<img alt="../_images/manual_2D_model_12_8.png" src="../_images/manual_2D_model_12_8.png" />
<img alt="../_images/manual_2D_model_12_9.png" src="../_images/manual_2D_model_12_9.png" />
<img alt="../_images/manual_2D_model_12_10.png" src="../_images/manual_2D_model_12_10.png" />


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Nicolas Cellier.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.0rc',
            LANGUAGE:'python',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>